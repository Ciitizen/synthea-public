{
  "name": "Metastatic Breast Cancer",
  "states": {

    "Initial": {
      "type": "Initial",
      "conditional_transition": [
        {
          "condition": {
            "condition_type": "Gender",
            "gender": "F"
          },
          "transition": "Select_For_Metastatic_Breast_Cancer"
        },
        {
          "transition": "Terminal"
        }
      ]
    },

    "Select_For_Metastatic_Breast_Cancer": {
      "type": "Simple",
      "remarks": [
        "1/8 women get breast cancer, 20-25% of those are stage IV at diagnosis.",
        "(1 / 8) * 0.25 => 0.03125 probability of getting stage IV breast cancer."
      ],
      "distributed_transition": [
        {
          "distribution": 0.03125,
          "transition": "Delay_For_Adulthood"
        },
        {
          "distribution": 0.96875,
          "transition": "Terminal"
        }
      ]
    },

    "Delay_For_Adulthood": {
      "type": "Delay",
      "remarks": [
        "On average women start getting annual mammograms at age 40. Not all women in ",
        "this pool will necessarily elect to get mammograms."
      ],
      "range": {
        "low": 35,
        "high": 45,
        "unit": "years"
      },
      "distributed_transition": [
        {
          "distribution": 0.8,
          "transition": "Ellective_Annual_Mammogram"
        },
        {
          "distribution": 0.2,
          "transition": "No_Ellective_Annual_Mammogram"
        }
      ]
    },

    "No_Ellective_Annual_Mammogram": {
      "type": "Simple",
      "direct_transition": "Delay_Until_Symptoms_Present"
    },

    "Delay_Until_Symptoms_Present": {
      "type": "Delay",
      "remarks": [
        "Of those women who do not get an annual mammogram, their breast cancer ",
        "will not be diagnosed until they present with symptoms and seek medical ",
        "attention."
      ],
      "range": {
        "low": 0,
        "high": 20,
        "unit": "years"
      },
      "direct_transition": "Symptoms_Present"
    },

    "Symptoms_Present": {
      "type": "Simple",
      "remarks": [
        "At this point in the module these women are experiencing symptoms bad enough ",
        "to merit a visit to the doctor."
      ],
      "direct_transition": "Encounter_For_Symptoms"
    },

    "Ellective_Annual_Mammogram": {
      "type": "CallSubmodule",
      "submodule": "procedures/mammogram",
      "direct_transition": "Abormal_Finding?"
    },

    "Abormal_Finding?": {
      "type": "Simple",
      "remarks": [
        "Following the annual mammogram, 2% of women will show abnormalities due to ",
        "breast cancer. The remainder will go back into the candidate pool and wait ",
        "until next year's mammogram."
      ],
      "distributed_transition": [
        {
          "distribution": 0.02,
          "transition": "Abnormality_Detected"
        },
        {
          "distribution": 0.98,
          "transition": "No_Abnormality_Detected"
        }
      ]
    },

    "Abnormality_Detected": {
      "type": "Simple",
      "direct_transition": "Delay_For_Mammogram_Review"
    },

    "No_Abnormality_Detected": {
      "type": "Simple",
      "direct_transition": "Delay_For_Next_Mammogram"
    },

    "Delay_For_Next_Mammogram": {
      "type": "Delay",
      "remarks": [
        "All women in the candidate pool will present with stage IV breast cancer ",
        "by age 65, many sooner than that."
      ],
      "range": {
        "low": 11,
        "high": 14,
        "unit": "months"
      },
      "conditional_transition": [
        {
          "condition": {
            "condition_type": "Age",
            "operator": ">=",
            "quantity": 65,
            "unit": "years"
          },
          "transition": "Symptoms_Present"
        },
        {
          "transition": "Ellective_Annual_Mammogram"
        }
      ]
    },

    "Encounter_For_Symptoms": {
      "type": "Encounter",
      "remarks": [
        "These women have not had a mammogram before. Once symptoms present these ",
        "women seek medical care."
      ],
      "encounter_class": "ambulatory",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "185345009",
          "display": "Encounter for symptom"
        }
      ],
      "direct_transition": "End_Encounter_For_Symptoms"
    },

    "End_Encounter_For_Symptoms": {
      "type": "EncounterEnd",
      "direct_transition": "Delay_For_Initial_Diagnostic_Mammogram"
    },

    "Delay_For_Initial_Diagnostic_Mammogram": {
      "type": "Delay",
      "range": {
        "low": 1,
        "high": 3,
        "unit": "days"
      },
      "direct_transition": "Initial_Diagnostic_Mammogram"
    },

    "Initial_Diagnostic_Mammogram": {
      "type": "CallSubmodule",
      "submodule": "procedures/mammogram",
      "direct_transition": "Delay_For_Mammogram_Review"
    },

    "Delay_For_Mammogram_Review": {
      "type": "Delay",
      "range": {
        "low": 1,
        "high": 3,
        "unit": "days"
      },
      "direct_transition": "Diagnosis_Encounter_Post_Mammogram"
    },

    "Diagnosis_Encounter_Post_Mammogram": {
      "type": "Encounter",
      "remarks": [
        "Once breast cancer is suspected (and at least one recent mammogram has been ",
        "performed to confirm), all women will have a followup encounter to review ",
        "the mammogram findings and to perform an initial biopsy and suite of tests."
      ],
      "encounter_class": "ambulatory",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "185345009",
          "display": "Encounter for symptom"
        }
      ],
      "direct_transition": "Mammogram_Findings"
    },

    "Mammogram_Findings": {
      "type": "Simple",
      "remarks": [
        "TODO: Make observations about the results of the mammogram."
      ],
      "direct_transition": "Breast_Biopsy"
    },

    "Breast_Biopsy": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "122548005",
          "display": "Biopsy of breast"
        }
      ],
      "direct_transition": "Biopsy_Findings"
    },

    "Biopsy_Findings": {
      "type": "Simple",
      "remarks": [
        "TODO: Make observations about the results of the biopsy."
      ],
      "direct_transition": "ImmunoHistoChemistry_Test"
    },

    "ImmunoHistoChemistry_Test": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "117617002",
          "display": "Immunohistochemistry procedure"
        }
      ],
      "direct_transition": "ImmunoHistoChemistry_Test_Findings"
    },

    "ImmunoHistoChemistry_Test_Findings": {
      "type": "Simple",
      "remarks": [
        "TODO: Record the results of the IHC test."
      ],
      "direct_transition": "Stage_IV_Breast_Cancer"
    },

    "Stage_IV_Breast_Cancer": {
      "type": "ConditionOnset",
      "target_encounter": "Diagnosis_Encounter_Post_Mammogram",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "254837009",
          "display": "Malignant neoplasm of breast"
        }
      ],
      "direct_transition": "End_Diagnosis_Encounter"
    },

    "End_Diagnosis_Encounter": {
      "type": "EncounterEnd",
      "direct_transition": "Receptor_Status"
    },

    "Receptor_Status": {
      "type": "Simple",
      "remarks": [
        "70% HR+/HER2-; 15% HR-/HER2+; 15% HR-/HER2- "
      ],
      "distributed_transition": [
        {
          "distribution": 0.7,
          "transition": "HR+/HER2-"
        },
        {
          "distribution": 0.15,
          "transition": "HR-/HER2+"
        },
        {
          "distribution": 0.15,
          "transition": "HR-/HER2-"
        }
      ]
    },

    "HR+/HER2-": {
      "type": "Simple",
      "remarks": [
        "======================================================================",
        "HR+/HER2- Endocrine Therapy                                           ",
        "======================================================================"
      ],
      "direct_transition": "Endocrine_Therapy_Initial_Encounter"
    },

    "Endocrine_Therapy_Initial_Encounter": {
      "type": "Encounter",
      "remarks": [
        "This is the initial encounter to begin endocrine therapy. ",
        "The patient is prescribed either Anastrazole or Tamoxifen ",
        "depending on her age, then started on the treatment cycle."
      ],
      "encounter_class": "ambulatory",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "308335008",
          "display": "Patient encounter procedure"
        }
      ],
      "conditional_transition": [
        {
          "condition": {
            "condition_type": "Age",
            "operator": ">=",
            "quantity": 50,
            "unit": "years"
          },
          "transition": "Prescribe_Anastrazole"
        },
        {
          "transition": "Prescribe_Tamoxifen"
        }
      ]
    },

    "Prescribe_Anastrazole": {
      "type": "MedicationOrder",
      "reason": "Stage_IV_Breast_Cancer",
      "codes": [
        {
          "system": "RxNorm",
          "code": "199224",
          "display": "Anastrazole 1MG Oral Tablet"
        }
      ],
      "direct_transition": "Baseline_Exam"
    },

    "Prescribe_Tamoxifen": {
      "type": "MedicationOrder",
      "reason": "Stage_IV_Breast_Cancer",
      "codes": [
        {
          "system": "RxNorm",
          "code": "198240",
          "display": "Tamoxifen 10MG Oral Tablet"
        }
      ],
      "direct_transition": "Baseline_Exam"
    },

    "Baseline_Exam": {
      "type": "CallSubmodule",
      "submodule": "procedures/full_breast_cancer_exam",
      "direct_transition": "End_Endocrine_Therapy_Initial_Encounter"
    },

    "End_Endocrine_Therapy_Initial_Encounter": {
      "type": "EncounterEnd",
      "direct_transition": "Endocrine_Therapy_Cycle"
    },

    "Endocrine_Therapy_Cycle": {
      "type": "Delay",
      "exact": {
        "quantity": 8,
        "unit": "weeks"
      },
      "direct_transition": "Endocrine_Therapy_Check_Up"
    },

    "Endocrine_Therapy_Check_Up": {
      "type": "Encounter",
      "encounter_class": "ambulatory",
      "direct_transition": "Routine_Exam"
    },

    "Routine_Exam": {
      "type": "CallSubmodule",
      "submodule": "procedures/full_breast_cancer_exam",
      "direct_transition": "End_Endocrine_Therapy_Check_Up"
    },

    "End_Endocrine_Therapy_Check_Up": {
      "type": "EncounterEnd",
      "direct_transition": "HR+/HER2-_Progression?"
    },

    "HR+/HER2-_Progression?": {
      "type": "Simple",
      "remarks": [
        "50% of patients have a 1st progression by 13 months. Given 8 weeks/cycle, ",
        "that's roughly 7 cycles before 50% of patients have progressed.",
        "Applying basic probability theory: ",
        "P(progression) = 0.5 = (1 - P(no_progression)) ^ 7 ",
        "P(no_progression) == 0.93 for each event ",
        "P(progression) == 0.07 for each event "
      ],
      "distributed_transition": [
        {
          "distribution": 0.93,
          "transition": "Endocrine_Therapy_Cycle"
        },
        {
          "distribution": 0.07,
          "transition": "HR+/HER2-_First_Progression"
        }
      ]
    },

    "HR+/HER2-_First_Progression": {
      "type": "Simple",
      "direct_transition": "HR+/HER2-_Eventual_Death"
    },

    "HR+/HER2-_Eventual_Death": {
      "type": "Death",
      "remarks": [
        "Schedules the future death of the patient. 50% mortality at 50mo., ",
        "long tail of 4 -> 6 -> 8 -> 10 yrs of survival for the remainder."
      ],
      "range": {
        "low": 10,
        "high": 120,
        "unit": "months"
      },
      "direct_transition": "Endocrine_Therapy_Cycle"
    },

    "HR-/HER2+": {
      "type": "Simple",
      "remarks": [
        "======================================================================",
        "HR-/HER2+ Chemotherapy and Endocrine Therapy                          ",
        "======================================================================"
      ],
      "direct_transition": "Terminal"
    },

    "HR-/HER2-": {
      "type": "Simple",
      "remarks": [
        "======================================================================",
        "HR-/HER2- Chemotherapy                                                ",
        "======================================================================"
      ],
      "direct_transition": "Terminal"
    },

    "Terminal": {
      "type": "Terminal"
    }
  }
}
